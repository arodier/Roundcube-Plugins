/*
 * jQuery MultiSelect UI Widget 1.14pre
 * Copyright (c) 2012 Eric Hynds
 *
 * http://www.erichynds.com/jquery/jquery-ui-multiselect-widget/
 *
 * Depends:
 *   - jQuery 1.4.2+
 *   - jQuery UI 1.8 widget factory
 *
 * Optional:
 *   - jQuery UI effects
 *   - jQuery UI position utility
 *
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 *
 */
!function(e){var t=0,i=e(document);e.widget("ech.multiselect",{options:{header:!0,height:175,minWidth:225,classes:"",checkAllText:"Check all",uncheckAllText:"Uncheck all",noneSelectedText:"Select options",selectedText:"# selected",selectedList:0,show:null,hide:null,autoOpen:!1,multiple:!0,position:{},appendTo:"body"},_create:function(){var i=this.element.hide(),s=this.options;this.speed=e.fx.speeds._default,this._isOpen=!1,this._namespaceID=this.eventNamespace||"multiselect"+t;var n=(this.button=e('<button type="button"><span class="ui-icon ui-icon-triangle-1-s"></span></button>')).addClass("ui-multiselect ui-widget ui-state-default ui-corner-all").addClass(s.classes).attr({title:i.attr("title"),"aria-haspopup":!0,tabIndex:i.attr("tabIndex")}).insertAfter(i),a=((this.buttonlabel=e("<span />")).html(s.noneSelectedText).appendTo(n),(this.menu=e("<div />")).addClass("ui-multiselect-menu ui-widget ui-widget-content ui-corner-all").addClass(s.classes).appendTo(e(s.appendTo))),o=(this.header=e("<div />")).addClass("ui-widget-header ui-corner-all ui-multiselect-header ui-helper-clearfix").appendTo(a);(this.headerLinkContainer=e("<ul />")).addClass("ui-helper-reset").html(function(){return s.header===!0?'<li><a class="ui-multiselect-all" href="#"><span class="ui-icon ui-icon-check"></span><span>'+s.checkAllText+'</span></a></li><li><a class="ui-multiselect-none" href="#"><span class="ui-icon ui-icon-closethick"></span><span>'+s.uncheckAllText+"</span></a></li>":"string"==typeof s.header?"<li>"+s.header+"</li>":""}).append('<li class="ui-multiselect-close"><a href="#" class="ui-multiselect-close"><span class="ui-icon ui-icon-circle-close"></span></a></li>').appendTo(o),(this.checkboxContainer=e("<ul />")).addClass("ui-multiselect-checkboxes ui-helper-reset").appendTo(a),this._bindEvents(),this.refresh(!0),s.multiple||a.addClass("ui-multiselect-single"),t++},_init:function(){this.options.header===!1&&this.header.hide(),this.options.multiple||this.headerLinkContainer.find(".ui-multiselect-all, .ui-multiselect-none").hide(),this.options.autoOpen&&this.open(),this.element.is(":disabled")&&this.disable()},refresh:function(i){var s=this.element,n=this.options,a=this.menu,o=this.checkboxContainer,r=[],l="",c=s.attr("id")||t++;s.find("option").each(function(t){e(this);var i,s=this.parentNode,a=this.innerHTML,o=this.title,u=this.value,d="ui-multiselect-"+(this.id||c+"-option-"+t),h=this.disabled,p=this.selected,f=["ui-corner-all"],m=(h?"ui-multiselect-disabled ":" ")+this.className;"OPTGROUP"===s.tagName&&(i=s.getAttribute("label"),-1===e.inArray(i,r)&&(l+='<li class="ui-multiselect-optgroup-label '+s.className+'"><a href="#">'+i+"</a></li>",r.push(i))),h&&f.push("ui-state-disabled"),p&&!n.multiple&&f.push("ui-state-active"),l+='<li class="'+m+'">',l+='<label for="'+d+'" title="'+o+'" class="'+f.join(" ")+'">',l+='<input id="'+d+'" name="multiselect_'+c+'" type="'+(n.multiple?"checkbox":"radio")+'" value="'+u+'" title="'+o+'"',p&&(l+=' checked="checked"',l+=' aria-selected="true"'),h&&(l+=' disabled="disabled"',l+=' aria-disabled="true"'),l+=" /><span>"+a+"</span></label></li>"}),o.html(l),this.labels=a.find("label"),this.inputs=this.labels.children("input"),this._setButtonWidth(),this._setMenuWidth(),this.button[0].defaultValue=this.update(),i||this._trigger("refresh")},update:function(){var t,i=this.options,s=this.inputs,n=s.filter(":checked"),a=n.length;return t=0===a?i.noneSelectedText:e.isFunction(i.selectedText)?i.selectedText.call(this,a,s.length,n.get()):/\d/.test(i.selectedList)&&i.selectedList>0&&a<=i.selectedList?n.map(function(){return e(this).next().text()}).get().join(", "):i.selectedText.replace("#",a).replace("#",s.length),this._setButtonValue(t),t},_setButtonValue:function(e){this.buttonlabel.text(e)},_bindEvents:function(){function t(){return s[s._isOpen?"close":"open"](),!1}var s=this,n=this.button;n.find("span").bind("click.multiselect",t),n.bind({click:t,keypress:function(e){switch(e.which){case 27:case 38:case 37:s.close();break;case 39:case 40:s.open()}},mouseenter:function(){n.hasClass("ui-state-disabled")||e(this).addClass("ui-state-hover")},mouseleave:function(){e(this).removeClass("ui-state-hover")},focus:function(){n.hasClass("ui-state-disabled")||e(this).addClass("ui-state-focus")},blur:function(){e(this).removeClass("ui-state-focus")}}),this.header.delegate("a","click.multiselect",function(t){e(this).hasClass("ui-multiselect-close")?s.close():s[e(this).hasClass("ui-multiselect-all")?"checkAll":"uncheckAll"](),t.preventDefault()}),this.menu.delegate("li.ui-multiselect-optgroup-label a","click.multiselect",function(t){t.preventDefault();var i=e(this),n=i.parent().nextUntil("li.ui-multiselect-optgroup-label").find("input:visible:not(:disabled)"),a=n.get(),o=i.parent().text();s._trigger("beforeoptgrouptoggle",t,{inputs:a,label:o})!==!1&&(s._toggleChecked(n.filter(":checked").length!==n.length,n),s._trigger("optgrouptoggle",t,{inputs:a,label:o,checked:a[0].checked}))}).delegate("label","mouseenter.multiselect",function(){e(this).hasClass("ui-state-disabled")||(s.labels.removeClass("ui-state-hover"),e(this).addClass("ui-state-hover").find("input").focus())}).delegate("label","keydown.multiselect",function(t){switch(t.preventDefault(),t.which){case 9:case 27:s.close();break;case 38:case 40:case 37:case 39:s._traverse(t.which,this);break;case 13:e(this).find("input")[0].click()}}).delegate('input[type="checkbox"], input[type="radio"]',"click.multiselect",function(t){var i=e(this),n=this.value,a=this.checked,o=s.element.find("option");return this.disabled||s._trigger("click",t,{value:n,text:this.title,checked:a})===!1?(t.preventDefault(),void 0):(i.focus(),i.attr("aria-selected",a),o.each(function(){this.value===n?this.selected=a:s.options.multiple||(this.selected=!1)}),s.options.multiple||(s.labels.removeClass("ui-state-active"),i.closest("label").toggleClass("ui-state-active",a),s.close()),s.element.trigger("change"),setTimeout(e.proxy(s.update,s),10),void 0)}),i.bind("mousedown."+this._namespaceID,function(t){var i=t.target;!s._isOpen||i===s.button[0]||i===s.menu[0]||e.contains(s.menu[0],i)||e.contains(s.button[0],i)||s.close()}),e(this.element[0].form).bind("reset.multiselect",function(){setTimeout(e.proxy(s.refresh,s),10)})},_setButtonWidth:function(){var e=this.element.outerWidth()+this.button.children("span").outerWidth()+2,t=this.options;/\d/.test(t.minWidth)&&e<t.minWidth&&(e=t.minWidth),this.button.outerWidth(e)},_setMenuWidth:function(){var e=this.menu;e.outerWidth(this.button.outerWidth())},_traverse:function(t,i){var s=e(i),n=38===t||37===t,a=s.parent()[n?"prevAll":"nextAll"]("li:not(.ui-multiselect-disabled, .ui-multiselect-optgroup-label)").first();if(a.length)a.find("label").trigger("mouseover");else{var o=this.menu.find("ul").last();this.menu.find("label")[n?"last":"first"]().trigger("mouseover"),o.scrollTop(n?o.height():0)}},_toggleState:function(e,t){return function(){this.disabled||(this[e]=t),t?this.setAttribute("aria-selected",!0):this.removeAttribute("aria-selected")}},_toggleChecked:function(t,i){var s=i&&i.length?i:this.inputs,n=this;s.each(this._toggleState("checked",t)),s.eq(0).focus(),this.update();var a=s.map(function(){return this.value}).get();this.element.find("option").each(function(){!this.disabled&&e.inArray(this.value,a)>-1&&n._toggleState("selected",t).call(this)}),s.length&&this.element.trigger("change")},_toggleDisabled:function(t){this.button.attr({disabled:t,"aria-disabled":t})[t?"addClass":"removeClass"]("ui-state-disabled");var i=this.menu.find("input"),s="ech-multiselect-disabled";i=t?i.filter(":enabled").data(s,!0):i.filter(function(){return e.data(this,s)===!0}).removeData(s),i.attr({disabled:t,"arial-disabled":t}).parent()[t?"addClass":"removeClass"]("ui-state-disabled"),this.element.attr({disabled:t,"aria-disabled":t})},open:function(){var t=this,i=this.button,s=this.menu,n=this.speed,a=this.options,o=[];if(this._trigger("beforeopen")!==!1&&!i.hasClass("ui-state-disabled")&&!this._isOpen){var r=s.find("ul").last(),l=a.show;e.isArray(a.show)&&(l=a.show[0],n=a.show[1]||t.speed),l&&(o=[l,n]),r.scrollTop(0).height(a.height),this.position(),e.fn.show.apply(s,o),this.labels.filter(":not(.ui-state-disabled)").eq(0).trigger("mouseover").trigger("mouseenter").find("input").trigger("focus"),i.addClass("ui-state-active"),this._isOpen=!0,this._trigger("open")}},close:function(){if(this._trigger("beforeclose")!==!1){var t=this.options,i=t.hide,s=this.speed,n=[];e.isArray(t.hide)&&(i=t.hide[0],s=t.hide[1]||this.speed),i&&(n=[i,s]),e.fn.hide.apply(this.menu,n),this.button.removeClass("ui-state-active").trigger("blur").trigger("mouseleave"),this._isOpen=!1,this._trigger("close")}},enable:function(){this._toggleDisabled(!1)},disable:function(){this._toggleDisabled(!0)},checkAll:function(){this._toggleChecked(!0),this._trigger("checkAll")},uncheckAll:function(){this._toggleChecked(!1),this._trigger("uncheckAll")},getChecked:function(){return this.menu.find("input").filter(":checked")},destroy:function(){return e.Widget.prototype.destroy.call(this),i.unbind(this._namespaceID),this.button.remove(),this.menu.remove(),this.element.show(),this},isOpen:function(){return this._isOpen},widget:function(){return this.menu},getButton:function(){return this.button},position:function(){var t=this.options;if(e.ui.position&&!e.isEmptyObject(t.position))t.position.of=t.position.of||this.button,this.menu.show().position(t.position).hide();else{var i=this.button.offset();this.menu.css({top:i.top+this.button.outerHeight(),left:i.left})}},_setOption:function(t,i){var s=this.menu;switch(t){case"header":s.find("div.ui-multiselect-header")[i?"show":"hide"]();break;case"checkAllText":s.find("a.ui-multiselect-all span").eq(-1).text(i);break;case"uncheckAllText":s.find("a.ui-multiselect-none span").eq(-1).text(i);break;case"height":s.find("ul").last().height(parseInt(i,10));break;case"minWidth":this.options[t]=parseInt(i,10),this._setButtonWidth(),this._setMenuWidth();break;case"selectedText":case"selectedList":case"noneSelectedText":this.options[t]=i,this.update();break;case"classes":s.add(this.button).removeClass(this.options.classes).addClass(i);break;case"multiple":s.toggleClass("ui-multiselect-single",!i),this.options.multiple=i,this.element[0].multiple=i,this.refresh();break;case"position":this.position()}e.Widget.prototype._setOption.apply(this,arguments)}})}(jQuery);
